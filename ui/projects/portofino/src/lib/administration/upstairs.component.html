<mat-tab-group>
  <mat-tab>
    <ng-template mat-tab-label>
      {{'Settings'|translate}}
    </ng-template>
    <form (submit)="saveSettings()">
      <portofino-form #settingsFormComponent [form]="settingsForm"></portofino-form>
      <div fxLayout="row">
        <button type="submit" style="display:none">{{ 'Save' | translate }}</button>
        <portofino-buttons [component]="this" list="settings"></portofino-buttons>
      </div>
    </form>
  </mat-tab>
  <mat-tab>
    <ng-template mat-tab-label>
      {{'Permissions'|translate}}
    </ng-template>
    <table *ngIf="settingsPanel.permissions">
      <tr>
        <th>{{'Group'|translate}}</th>
        <th>{{'Access level'|translate}}</th>
      </tr>
      <tr *ngFor="let group of settingsPanel.groups">
        <td>{{group.name}}</td>
        <td>
          <mat-select [(ngModel)]="group.level">
            <mat-option *ngFor="let level of settingsPanel.accessLevels" [value]="level">
              {{level}}
            </mat-option>
          </mat-select>
        </td>
      </tr>
    </table>
    <portofino-buttons [component]="this" list="permissions"></portofino-buttons>
  </mat-tab>
  <mat-tab>
    <ng-template mat-tab-label>
      {{'Database connections'|translate}}
    </ng-template>
    <ng-container *ngIf="!connectionProvider">
      <table *ngIf="connectionProviders">
        <tr>
          <th>{{'Name'|translate}}</th>
          <th>{{'Description'|translate}}</th>
          <th>{{'Status'|translate}}</th>
        </tr>
        <tr *ngFor="let conn of connectionProviders">
          <td><a href="javascript:void(0)" (click)="openConnectionProvider(conn);">{{conn.name}}</a></td>
          <td>{{conn.description}}</td>
          <td>{{conn.status | translate}}</td>
        </tr>
      </table>
      <portofino-buttons [component]="this" list="connections"></portofino-buttons>
      <h3>{{'Available database platforms' | translate}}</h3>
      <table *ngIf="databasePlatforms">
        <tr>
          <th>{{'Description'|translate}}</th>
          <th>{{'Standard driver class name'|translate}}</th>
          <th>{{'Status'|translate}}</th>
        </tr>
        <tr *ngFor="let platform of databasePlatforms">
          <td>{{platform.description}}</td>
          <td>{{platform.standardDriverClassName}}</td>
          <td>{{platform.status | translate}}</td>
        </tr>
      </table>
    </ng-container>
    <ng-container *ngIf="connectionProvider">
      <form>
        <mat-form-field>
          <mat-label>{{'Name'|translate}}</mat-label>
          <input name="name" matInput required [(ngModel)]="connectionProvider.databaseName.value"
                 [disabled]="true" />
        </mat-form-field>
        <ng-container *ngIf="connectionProvider.jndiResource.value">
          <mat-form-field>
            <mat-label>{{'JNDI Resource'|translate}}</mat-label>
            <input name="jndiResource" matInput required [(ngModel)]="connectionProvider.jndiResource.value"
                   [disabled]="!isEditConnectionProvider" />
          </mat-form-field>
        </ng-container>
        <ng-container *ngIf="!connectionProvider.jndiResource.value">
          <mat-form-field>
            <mat-label>{{'Driver'|translate}}</mat-label>
            <input name="driver" matInput required [(ngModel)]="connectionProvider.driver.value"
                   [disabled]="!isEditConnectionProvider" />
          </mat-form-field>
          <mat-form-field>
            <mat-label>{{'Connection URL'|translate}}</mat-label>
            <input name="url" matInput required [(ngModel)]="connectionProvider.url.value"
                   [disabled]="!isEditConnectionProvider" />
          </mat-form-field>
          <mat-form-field>
            <mat-label>{{'Username'|translate}}</mat-label>
            <input name="username" matInput [(ngModel)]="connectionProvider.username.value"
                   [disabled]="!isEditConnectionProvider" />
          </mat-form-field>
          <mat-form-field>
            <mat-label>{{'Password'|translate}}</mat-label>
            <input name="password" type="password" matInput [(ngModel)]="connectionProvider.password.value"
                   [disabled]="!isEditConnectionProvider" />
          </mat-form-field>
          <mat-form-field>
            <mat-label>{{'Hibernate dialect'|translate}}</mat-label>
            <input name="dialect" matInput [(ngModel)]="connectionProvider.hibernateDialect.value"
                   [disabled]="!isEditConnectionProvider" />
            <mat-hint>{{'leave empty to use default'|translate}}</mat-hint>
          </mat-form-field>
          <mat-form-field>
            <mat-label>{{'True string'|translate}}</mat-label>
            <input name="true-string" matInput [(ngModel)]="connectionProvider.trueString.value"
                   [disabled]="!isEditConnectionProvider" />
          </mat-form-field>
          <mat-form-field>
            <mat-label>{{'False string'|translate}}</mat-label>
            <input name="false-string" matInput [(ngModel)]="connectionProvider.falseString.value"
                   [disabled]="!isEditConnectionProvider" />
          </mat-form-field>
        </ng-container>
        <mat-divider></mat-divider>
        <h3>{{'Schemas'|translate}}</h3>
        <table>
          <tr>
            <th></th>
            <th>{{'Schema'|translate}}</th>
            <th>{{'Schema name'|translate}}</th>
          </tr>
          <tr *ngFor="let schema of connectionProvider.schemas; let i = index;">
            <td><mat-checkbox [(ngModel)]="schema.selected"
                              name="selected{{i}}" [disabled]="!isEditConnectionProvider"></mat-checkbox></td>
            <td>{{schema.schema}}</td>
            <td><input matInput [(ngModel)]="schema.name"
                       name="schemaName{{i}}" [disabled]="!isEditConnectionProvider"/></td>
          </tr>
        </table>
        <div><portofino-buttons [component]="this" list="connection"></portofino-buttons></div>
      </form>
    </ng-container>
  </mat-tab>
  <mat-tab>
    <ng-template mat-tab-label>
      {{'Tables'|translate}}
    </ng-template>
    <mat-tree [dataSource]="tableTreeDataSource" [treeControl]="tableTreeControl">
      <mat-tree-node *matTreeNodeDef="let node" matTreeNodeToggle matTreeNodePadding>
        <a href="javascript:void(0)">{{node.displayName}}</a>
      </mat-tree-node>
      <mat-tree-node *matTreeNodeDef="let node;when: isExpandable" matTreeNodePadding>
        <button mat-icon-button matTreeNodeToggle
                [attr.aria-label]="'toggle ' + node.name">
          <mat-icon class="mat-icon-rtl-mirror">
            {{tableTreeControl.isExpanded(node) ? 'expand_more' : 'chevron_right'}}
          </mat-icon>
        </button>
        {{node.displayName}}
        <mat-progress-bar *ngIf="node.loading" mode="indeterminate"></mat-progress-bar>
      </mat-tree-node>
    </mat-tree>
  </mat-tab>
</mat-tab-group>
